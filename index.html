<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankey Diagram</title>
    <!-- Import D3.js -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- Import D3 Sankey Plugin -->
    <script src="https://d3js.org/d3-sankey.v0.12.min.js"></script>
    <style>
        body { margin: 0; position: fixed; top: 0; bottom: 0; width: 100%; }
        #sankey { width: 100%; height: 100vh; }
    </style>
</head>
<body>
    <div id="sankey"></div>
    <script>
        // Initialize the Sankey diagram
        function renderSankey(data) {
            const svg = d3.select("#sankey").append("svg")
                .attr("width", "100%")
                .attr("height", "100%");

            const sankey = d3.sankey()
                .nodeWidth(15)
                .nodePadding(10)
                .extent([[1, 1], [window.innerWidth - 1, window.innerHeight - 5]]);

            const {nodes, links} = sankey(data);

            svg.append("g")
                .selectAll("rect")
                .data(nodes)
                .enter().append("rect")
                .attr("x", d => d.x0)
                .attr("y", d => d.y0)
                .attr("height", d => d.y1 - d.y0)
                .attr("width", sankey.nodeWidth())
                .style("fill", "navy");

            svg.append("g")
                .attr("fill", "none")
                .selectAll("path")
                .data(links)
                .enter().append("path")
                .attr("d", d3.sankeyLinkHorizontal())
                .attr("stroke", "grey")
                .attr("stroke-width", d => Math.max(1, d.width));
        }

        // Function to update data
        function updateSankey(newData) {
            d3.select("svg").remove(); // Clear the previous diagram
            renderSankey(newData);    // Render new diagram with the new data
        }

        // Example data to render initially
        document.addEventListener("DOMContentLoaded", function() {
            const initialData = {
                nodes: [
                    {id: 0, name: "source"},
                    {id: 1, name: "target"}
                ],
                links: [
                    {source: 0, target: 1, value: 2}
                ]
            };
            renderSankey(initialData);
        });
    </script>
</body>
</html>
